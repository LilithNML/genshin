<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#121212" />
  <title>Genshin Pity Tracker</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  <style>
    :root {
      --bg: #121212;
      --fg: #ffffff;
      --card: #1e1e1e;
      --accent: #bb86fc;
      --warning: #fca311;
    }
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: var(--bg);
      color: var(--fg);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
    }
    .container {
      width: 100%;
      max-width: 500px;
    }
    .card {
      background: var(--card);
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    h2, h3 {
      margin: 0 0 0.5rem;
    }
    button {
      background: var(--accent);
      color: #000;
      border: none;
      padding: 0.75rem;
      border-radius: 8px;
      font-weight: bold;
      margin: 0.25rem;
      cursor: pointer;
    }
    input {
      padding: 0.5rem;
      border-radius: 6px;
      border: none;
      width: 100%;
      margin-top: 0.5rem;
    }
    .warning {
      color: var(--warning);
      font-weight: bold;
    }
    .row { display: flex; flex-wrap: wrap; justify-content: center; }
    .entry { margin-top: 0.5rem; font-size: 0.9rem; border-bottom: 1px solid #333; padding-bottom: 0.25rem; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Genshin Pity Tracker</h2>

    <div class="card">
      <h3>Estado actual</h3>
      <p><strong>Tiradas desde √∫ltimo 4‚≠ê:</strong> <span id="pity4">0</span></p>
      <p><strong>Tiradas desde √∫ltimo 5‚≠ê:</strong> <span id="pity5">0</span></p>
      <p class="warning" id="warnings"></p>
    </div>

    <div class="card">
      <h3>Registrar tirada</h3>
      <input type="text" id="characterName" placeholder="Nombre del personaje (opcional)">
      <div class="row">
        <button onclick="addPull()">Solo tirada</button>
        <button onclick="addPull('4')">Personaje 4‚≠ê</button>
        <button onclick="addPull('5')">Personaje 5‚≠ê</button>
      </div>
    </div>

    <div class="card">
      <h3>Historial</h3>
      <div id="history"></div>
    </div>

    <div class="card">
      <h3>Datos</h3>
      <button onclick="exportData()">üì§ Exportar</button>
      <button onclick="importData()">üì• Importar</button>
      <input type="file" id="fileInput" accept="application/json" style="display:none" onchange="handleFile(event)">
    </div>
  </div>

  <script>
    let pity4 = 0, pity5 = 0, history = [];

    function updateDisplay() {
      document.getElementById('pity4').textContent = pity4;
      document.getElementById('pity5').textContent = pity5;

      const warnings = [];
      if (pity4 >= 9) warnings.push(`‚ö†Ô∏è Est√°s a ${10 - pity4} de un 4‚≠ê asegurado`);
      if (pity5 >= 89) warnings.push(`‚ö†Ô∏è Est√°s a ${90 - pity5} de un 5‚≠ê asegurado`);
      document.getElementById('warnings').innerHTML = warnings.join('<br>');

      document.getElementById('history').innerHTML = history.map(e =>
        `<div class='entry'>${e.time} - ${e.type}${e.name ? `: ${e.name}` : ''}</div>`
      ).join('');

      localStorage.setItem('pity4', pity4);
      localStorage.setItem('pity5', pity5);
      localStorage.setItem('history', JSON.stringify(history));
    }

    function addPull(type = '') {
      const name = document.getElementById('characterName').value.trim();
      if (type === '4') pity4 = 0; else pity4++;
      if (type === '5') pity5 = 0; else pity5++;
      history.unshift({
        time: new Date().toLocaleString(),
        type: type ? `${type}‚≠ê` : 'Tirada',
        name
      });
      document.getElementById('characterName').value = '';
      updateDisplay();
    }

    function exportData() {
      const data = JSON.stringify({ pity4, pity5, history });
      const blob = new Blob([data], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'pity_genshin.json';
      link.click();
    }

    function importData() {
      document.getElementById('fileInput').click();
    }

    function handleFile(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        try {
          const data = JSON.parse(e.target.result);
          pity4 = data.pity4 || 0;
          pity5 = data.pity5 || 0;
          history = data.history || [];
          updateDisplay();
        } catch {
          alert('Archivo inv√°lido');
        }
      };
      reader.readAsText(file);
    }

    window.addEventListener('load', () => {
      pity4 = +localStorage.getItem('pity4') || 0;
      pity5 = +localStorage.getItem('pity5') || 0;
      history = JSON.parse(localStorage.getItem('history') || '[]');
      updateDisplay();

      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js')
          .then(() => console.log('SW registrado'))
          .catch(err => console.warn('SW no registrado', err));
      }
    });
  </script>
</body>
</html>
